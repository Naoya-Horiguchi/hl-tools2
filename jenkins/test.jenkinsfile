#!/usr/bin/env groovy

// only testing (assuming that build/deploy is properly done via CodeBuild/CodeDeploy)

pipeline {
	agent {label 'ec2_static'}

	environment {
		GOPATH = '/home/ubuntu/workspace/go'
	}

	stages {
		stage('RunTest') {

			steps {
				withEnv(['PATH+EXTRA=/usr/local/go/bin']) {
					sh '''
						cd /home/ubuntu/workspace/$JOB_NAME/tests/v1.3.0/balance-transfer
						echo "Running Testcases"
						echo "$(date): $(hostname)"
						sudo make prepare
						sudo make run_all
						bash -c "PATH=$PATH bash /home/ubuntu/workspace/$JOB_NAME/jenkins/save_output.sh $JOB_NAME"
						'''
				}
			}
		}
	}
}
